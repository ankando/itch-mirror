name: Mirror Itch.io Builds

on:
  workflow_dispatch:

jobs:
  mirror-itch:
    runs-on: ubuntu-latest

    env:
      BUTLER_API_KEY: ${{ secrets.BUTLER_API_KEY }}
      ITCH_PROJECT: yourusername/mindustry
      RELEASE_TAG: itch-mirror

    steps:
      - name: Set up Git
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"

      - name: Install butler
        run: |
          wget -qO- https://broth.itch.ovh/butler/linux-amd64-head/butler.gz | gunzip > butler
          chmod +x butler
          sudo mv butler /usr/local/bin

      - name: Download builds from Itch.io
        run: |
          mkdir -p itch-download
          butler -j download "$ITCH_PROJECT" itch-download --headless

      - name: Archive downloaded files
        run: |
          cd itch-download
          zip -r ../itch-artifact.zip .

      - name: Upload to Release as artifact
        uses: softprops/action-gh-release@v2
        with:
          tag_name: ${{ env.RELEASE_TAG }}
          files: itch-artifact.zip
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
