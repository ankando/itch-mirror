name: Mirror Itch.io Builds

on:
  # 每次 push（任意分支）
  push:
    branches:
      - '*'

  # 每天凌晨 00:00 UTC（北京时间 08:00）
  schedule:
    - cron: '0 0 * * *'

  # 手动触发（可选）
  workflow_dispatch:

jobs:
  mirror-itch:
    runs-on: ubuntu-latest
    env:
      BUTLER_API_KEY: ${{ secrets.BUTLER_API_KEY }}
      ITCH_PROJECT: yourusername/mindustry
      RELEASE_TAG: itch-mirror

    steps:
      - name: Setup Git
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"

      - name: Install butler stable version
        run: |
          curl -L -o butler.zip https://broth.itch.zone/butler/linux-amd64/15.24.0/archive/default
          unzip butler.zip
          chmod +x butler
          ./butler -V
          sudo mv butler /usr/local/bin

      - name: Download from Itch.io
        run: |
          mkdir itch-download
          butler -j download "$ITCH_PROJECT" itch-download --headless

      - name: Archive files
        run: |
          cd itch-download
          zip -r ../itch-artifact.zip .

      - name: Upload artifact to Release
        uses: softprops/action-gh-release@v2
        with:
          tag_name: ${{ env.RELEASE_TAG }}
          files: itch-artifact.zip
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
