name: Mirror Mindustry Itch Builds

on:
  schedule:
    - cron: '0 0 * * *'
  workflow_dispatch:
  push:
    paths:
      - '.github/workflows/*.yml'

jobs:
  mirror:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Set up environment
        run: |
          sudo apt-get update
          sudo apt-get install -y curl
          curl -LsSf https://astral.sh/uv/install.sh | sh
          echo "$HOME/.local/bin" >> $GITHUB_PATH

      - name: Download files from itch.io
        run: |
          mkdir -p builds
          ~/.local/bin/uvx itch-dl https://anuke.itch.io/mindustry \
            --api-key "${{ secrets.ITCH_API_KEY }}" \
            --download-to builds
            
      - name: check downloaded files
        run: |
             ls -R builds

      - name: Release
        uses: actions/upload-artifact@v4.6.2
        with:
          name: ${{ env.RELEASE_VERSION }}
          path: build/anuke/mindustry/files
